<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.shop.mapper.ShopMapper">

	<select id="detail" parameterType="String" resultType="ecommerceVO">
		select *
		  from ECOMMERCE
		 where EC_ID = #{ecId}
	</select>
	
	<insert id="createProduct" parameterType="ecommerceVO">
		<selectKey resultType="String" order="BEFORE" keyProperty="ecId">
         SELECT NVL(SUBSTR(MAX(EC_ID),1,2) 
          || TRIM(TO_CHAR(SUBSTR(MAX(EC_ID),3)+1,'000')),'EC001') FROM ECOMMERCE
      	</selectKey>
		insert into ECOMMERCE(EC_ID, EC_NAME, EC_PRICE, EC_DETAIL)
		values (#{ecId},#{ecName},#{ecPrice},#{ecDetail})
	</insert>
	
	<insert id="insertEcommerceAttach" parameterType="ecommerceAttachVO">
		insert into ECOMMERCE_ATTACH(EC_ID, EC_IMG, EC_URL, EC_SIZE, EC_TYPE)
		VALUES (#{ecId} , #{ecImg} , #{ecUrl} , #{ecSize} , #{ecType})
	</insert>
	
	<resultMap type="ecommerceVO" id="ecommerceMap">
		<result property="ecId" column="EC_ID"/>
		<result property="ecName" column="EC_NAME"/>
		<result property="ecPrice" column="EC_PRICE"/>
		<result property="ecDetail" column="EC_DETAIL"/>
		
		<collection property="ecommerceAttachVOList" resultMap="ecommerceMap"></collection>
	</resultMap>
	
	<resultMap type="ecommerceAttachVO" id="ecmmerceAttachMap">
		<result property="ecId" column="EC_ID"/>
		<result property="ecImg" column="EC_IMG"/>
		<result property="ecUrl" column="EC_URL"/>
		<result property="ecSize" column="EC_SIZE"/>
		<result property="ecType" column="EC_TYPE"/>
	</resultMap>
		
	<insert id="insertColor" parameterType="ecommerceColorVO">
			INSERT INTO ECOMMERCE_COLOR(EC_ID , EC_COLOR)
			VALUES(#{ecId} , #{ecColor})
	</insert>
	
	<insert id="insertSize" parameterType="ecommerceSizeVO">
			INSERT INTO ECOMMERCE_SIZE(EC_ID, EC_SIZE)
			VALUES(#{ecId} , #{ecSize})
	</insert>

	<select id="list" parameterType="String" resultType="kr.or.ddit.vo.TestVO">
		select EC_ID, EC_NAME, EC_PRICE, EC_DETAIL, EC_IMG, EC_URL, EC_COLOR, EC_SIZE
		  from test
		 where ec_id = #{ecId}
	</select>
	
</mapper>